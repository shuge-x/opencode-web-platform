# Phase 1 开发计划 - Web Chat MVP

**阶段**: Phase 1 - MVP核心功能
**目标**: 完整可用的Web Chat系统
**授权**: 术哥授权自主决策，最终验收
**开始时间**: 2026-02-13 14:57 UTC
**负责人**: 术维斯1号

---

## 核心目标

**最终交付**：完整的Web Chat MVP系统，可直接验收

**核心功能**（必须100%完成）：
1. ✅ 用户注册/登录（JWT认证）
2. ✅ 多会话管理（创建、切换、删除）
3. ✅ 实时对话（WebSocket）
4. ✅ opencode集成（Sidecar调用）
5. ✅ 消息流式展示（thinking + tool_call事件）
6. ✅ 文件操作（上传、下载、编辑）
7. ✅ 工具调用可视化（显示工具执行过程）
8. ✅ 会话历史持久化

---

## 开发策略

### 阶段划分（并行推进）

#### Sprint 1: 核心对话功能（3-4天）
**后端**：
- [x] JWT认证API（已完成）
- [ ] WebSocket实时通信
- [ ] Celery任务队列
- [ ] opencode Sidecar集成
- [ ] 会话消息持久化

**前端**：
- [x] 登录页面（已完成）
- [ ] 聊天界面
- [ ] WebSocket连接
- [ ] 消息渲染（Markdown + 代码高亮）

#### Sprint 2: 会话管理（2-3天）
**后端**：
- [ ] 会话CRUD API
- [ ] 会话列表查询
- [ ] 会话搜索功能

**前端**：
- [ ] 会话列表侧边栏
- [ ] 会话切换
- [ ] 会话删除

#### Sprint 3: 文件操作（2-3天）
**后端**：
- [ ] 文件上传API
- [ ] 文件下载API
- [ ] 文件编辑API
- [ ] 文件存储（本地/S3）

**前端**：
- [ ] 文件上传组件
- [ ] 文件浏览器
- [ ] 代码编辑器（Monaco Editor）

#### Sprint 4: 工具调用可视化（2-3天）
**后端**：
- [ ] 工具调用事件流
- [ ] 工具执行日志
- [ ] 权限确认API

**前端**：
- [ ] 工具调用卡片
- [ ] 执行日志展示
- [ ] 权限确认弹窗

#### Sprint 5: 优化与测试（2天）
**后端**：
- [ ] API限流
- [ ] 错误处理
- [ ] 性能优化
- [ ] 单元测试

**前端**：
- [ ] UI优化
- [ ] 响应式设计
- [ ] 错误处理
- [ ] E2E测试

---

## 技术栈确认

### 后端
- FastAPI 0.109.0
- SQLAlchemy 2.0.25（异步）
- Celery 5.3.6
- Redis 5.0.1
- PostgreSQL 15
- opencode CLI（Sidecar）

### 前端
- React 19.2.0
- TypeScript 5.9.3
- Zustand 5.0.11
- Ant Design 6.3.0
- Monaco Editor
- Axios

### 基础设施
- Docker + Docker Compose
- PostgreSQL
- Redis
- Celery Worker

---

## 验收标准（必须100%达成）

### 功能验收
- [ ] 用户可以注册并登录
- [ ] 用户可以创建多个会话
- [ ] 用户可以在会话中实时对话
- [ ] 对话消息实时展示（流式）
- [ ] 工具调用过程可视化
- [ ] 用户可以上传/下载/编辑文件
- [ ] 会话历史持久化保存
- [ ] 系统稳定无崩溃

### 性能验收
- [ ] API响应时间 < 500ms
- [ ] WebSocket延迟 < 100ms
- [ ] 支持10+并发用户
- [ ] 前端首屏加载 < 3s

### 质量验收
- [ ] 后端测试覆盖率 > 60%
- [ ] 前端无console错误
- [ ] API文档完整准确
- [ ] 代码有完整注释

---

## 风险管理

### 高风险
1. **opencode CLI不可用**
   - 缓解：准备Mock方案
   - 降级：使用预设响应

2. **Celery配置复杂**
   - 缓解：使用Docker简化
   - 降级：使用FastAPI BackgroundTasks

3. **WebSocket连接不稳定**
   - 缓解：实现重连机制
   - 降级：轮询模式

### 中风险
1. **文件上传大小限制**
   - 缓解：分片上传
   - 限制：单文件 < 50MB

2. **数据库性能**
   - 缓解：添加索引
   - 优化：分页查询

---

## 开发原则

1. **快速迭代**：先实现核心功能，再优化细节
2. **并行开发**：前后端同时推进
3. **持续集成**：每日合并代码，保持主分支可用
4. **质量第一**：功能必须完整可用，不能半成品
5. **用户体验**：界面友好，操作流畅

---

## 交付清单

### 代码
- [x] Backend完整代码
- [x] Frontend完整代码
- [ ] Docker Compose配置
- [ ] 环境变量模板（.env.example）
- [ ] README（启动指南）

### 文档
- [x] API文档（Swagger）
- [ ] 部署文档
- [ ] 用户手册

### 测试
- [ ] 单元测试
- [ ] 集成测试
- [ ] E2E测试

---

## 时间规划

**总工期**：12-15天（加速版，原计划4-6周）

| Sprint | 时间 | 目标 |
|--------|------|------|
| Sprint 1 | Day 1-4 | 核心对话功能 |
| Sprint 2 | Day 5-7 | 会话管理 |
| Sprint 3 | Day 8-10 | 文件操作 |
| Sprint 4 | Day 11-12 | 工具可视化 |
| Sprint 5 | Day 13-15 | 优化测试 |

**目标完成日期**：2026-02-28

---

## 自主决策授权

**术哥授权**：
- ✅ 技术选型决策
- ✅ 功能优先级调整
- ✅ 开发节奏把控
- ✅ 质量标准把控
- ✅ 风险应对决策
- ✅ 小问题团队自决

**需要术哥决策的大问题**：
- ❗ 核心架构变更
- ❗ 关键功能删减
- ❗ 重大技术风险
- ❗ 项目延期超过3天

**最终验收**：
- 所有功能100%完成
- 系统稳定可运行
- 代码质量达标
- 文档完整准确
- 完工后立刻汇报

---

**创建时间**: 2026-02-13 14:57 UTC
**负责人**: 术维斯1号
**状态**: 🚀 开发中
